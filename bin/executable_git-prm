#!/usr/bin/env bash

set -euo pipefail

usage() {
  cat <<EOS
  Usage: 
    git prm <path>
EOS
}

__dbg() {
  [ -v DEBUG ] || return
  echo "[DBG] $@" >&2
}

__root() {
  git config --get pclone.root
}

cfg="git config --file $(git config --get pclone.root)/$(git config --get pclone.conf)"


path=$1
subdir=$(echo $path | sed "s#^$(__root)/\?##")
cfg_name=$(echo $subdir | sed 's#/#__#g')
config=$($cfg --get-regexp "pclone.repo.$cfg_name.url")

echo "Got remote $config"

git --work-tree=$path status

read -p "Remove repo from $path [y/N]? " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]; then
  rm -r "$path"
  $cfg --remove-section "pclone.repo.$cfg_name"
fi
